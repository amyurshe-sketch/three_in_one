const translations={ru:{'form.required':'Пожалуйста, заполните все поля','form.emailError':'Пожалуйста, введите корректный email или номер телефона','form.success':'Сообщение успешно отправлено!','form.error':'Ошибка отправки сообщения. Попробуйте еще раз.','form.sending':'Отправка...','modal.title':'Спасибо за сообщение!','modal.message':'Мы свяжемся с вами в ближайшее время.','modal.button':'Закрыть'},en:{'form.required':'Please fill in all fields','form.emailError':'Please enter a valid email or phone number','form.success':'Message sent successfully!','form.error':'Error sending message. Please try again.','form.sending':'Sending...','modal.title':'Thank you for your message!','modal.message':'We will contact you shortly.','modal.button':'Close'}};class AppManager{constructor(){this.currentTheme=localStorage.getItem('theme')||'light';this.currentLanguage=localStorage.getItem('language')||'ru';this.init();}init(){this.applyTheme(this.currentTheme);this.applyLanguage(this.currentLanguage);this.setupEventListeners();this.updateLanguageDisplay();}setupEventListeners(){const e=document.getElementById('themeToggle');e&&e.addEventListener('click',()=>{this.toggleTheme();});const t=document.getElementById('langToggle');t&&t.addEventListener('click',()=>{this.toggleLanguage();});const o=document.getElementById('closeModal');o&&o.addEventListener('click',()=>{this.hideModal();});const i=document.getElementById('successModal');i&&i.addEventListener('click',e=>{e.target===e.currentTarget&&this.hideModal();});}toggleTheme(){this.currentTheme='light'===this.currentTheme?'dark':'light';this.applyTheme(this.currentTheme);localStorage.setItem('theme',this.currentTheme);}applyTheme(e){document.body.className='dark'===e?'theme-dark':'theme-light';const t=document.getElementById('themeToggle');if(t){const o=t.querySelector('i');o&&('dark'===e?o.className='fas fa-sun':o.className='fas fa-moon');}}toggleLanguage(){this.currentLanguage='ru'===this.currentLanguage?'en':'ru';this.applyLanguage(this.currentLanguage);localStorage.setItem('language',this.currentLanguage);this.updateLanguageDisplay();this.updateButtonTexts();}updateLanguageDisplay(){const e=document.getElementById('langToggle');e&&(e.innerHTML='ru'===this.currentLanguage?'EN <i class="fas fa-globe"></i>':'RU <i class="fas fa-globe"></i>');document.querySelectorAll('.lang-ru, .lang-en').forEach(e=>{e&&e.classList&&(e.classList.contains('lang-ru')&&(e.style.display='ru'===this.currentLanguage?'block':'none'),e.classList.contains('lang-en')&&(e.style.display='en'===this.currentLanguage?'block':'none'));});}updateButtonTexts(){document.querySelectorAll('#submitBtn').forEach(e=>{e&&('ru'===this.currentLanguage?e.textContent='Отправить сообщение':e.textContent='Send Message');});}applyLanguage(e){document.querySelectorAll('[data-i18n]').forEach(t=>{if(t&&t.getAttribute){const o=t.getAttribute('data-i18n');translations[e]&&translations[e][o]&&(t.textContent=translations[e][o]);}});}showModal(){const e=document.getElementById('successModal');e&&(e.classList.add('active'),document.body.style.overflow='hidden');}hideModal(){const e=document.getElementById('successModal');e&&(e.classList.remove('active'),document.body.style.overflow='auto');}getTranslation(e){return translations[this.currentLanguage][e]||e;}}const app=new AppManager();const contactForm=document.getElementById('contactForm');contactForm&&contactForm.addEventListener('submit',async e=>{e.preventDefault();const t=new FormData(contactForm),o={name:t.get('name'),phone:t.get('email'),service:'Веб-разработка',message:t.get('message')};if(!o.name||!o.phone||!o.message)return void alert(app.getTranslation('form.required'));const i=contactForm.querySelectorAll('button[type="submit"]'),n=[];i.forEach(e=>{e&&(n.push(e.textContent),e.textContent=app.getTranslation('form.sending'),e.disabled=!0);});try{const e=await fetch('/api/telegram',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(o)}),t=await e.json();'success'===t.status?(app.showModal(),contactForm.reset()):(console.error('Ошибка отправки:',t.message),alert(app.getTranslation('form.error')));}catch(e){console.error('Ошибка отправки формы:',e),alert(app.getTranslation('form.error'));}finally{i.forEach((e,t)=>{e&&(e.textContent=n[t],e.disabled=!1);});}});function initializeObservers(){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target&&e.target.classList.add('animate-fadeIn');});},{threshold:.1,rootMargin:'0px 0px -50px 0px'});document.querySelectorAll('.service-card, .portfolio-item, .skill-item, .contact-form, .contact-info').forEach(t=>{t&&1===t.nodeType&&e.observe(t);});const t=document.querySelectorAll('.skill-progress');if(t.length>0){const e=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting&&e.target){const t=e.target.getAttribute('data-width')||'0%';e.target.style.width='0%',setTimeout(()=>{e.target.style.width=t,e.target.style.setProperty('--progress-width',t);},50);}});},{threshold:.3});t.forEach(t=>{t&&1===t.nodeType&&(t.style.width='0%',e.observe(t));});}}function initializeSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e&&e.addEventListener('click',function(e){e.preventDefault();const t=document.querySelector(this.getAttribute('href'));t&&t.scrollIntoView({behavior:'smooth',block:'start'});});});}function initializeMobileMenu(){const e=document.querySelector('.menu-toggle'),t=document.querySelector('.nav-links');e&&t&&(e.addEventListener('click',()=>{const e='flex'===t.style.display;t.style.display=e?'none':'flex';}),document.querySelectorAll('.nav-links a').forEach(e=>{e&&e.addEventListener('click',()=>{window.innerWidth<=768&&(t.style.display='none');});}));}function initializeHeaderAnimation(){window.addEventListener('scroll',()=>{const e=document.querySelector('header');e&&(window.scrollY>100?(e.style.background='var(--glass)',e.style.backdropFilter='blur(15px)'):(e.style.background='transparent',e.style.backdropFilter='none'));});}function initializeModalHandlers(){document.addEventListener('keydown',function(e){'Escape'===e.key&&app.hideModal();}),document.addEventListener('click',function(e){const t=document.getElementById('successModal');if(!t)return;('closeModal'===e.target.id||'modalCloseBtn'===e.target.id)&&(t.classList.remove('active'),document.body.style.overflow='auto'),e.target===t&&(t.classList.remove('active'),document.body.style.overflow='auto');});}function initializeHeroAnimation(){const e=document.querySelector('.hero-content');e&&(e.style.opacity='0',e.style.transform='translateY(30px)',setTimeout(()=>{e.style.transition='all 1s ease',e.style.opacity='1',e.style.transform='translateY(0)';},300));}document.addEventListener('DOMContentLoaded',function(){const e=document.querySelector('header');e&&(e.style.transition='all 0.3s ease'),initializeObservers(),initializeSmoothScroll(),initializeMobileMenu(),initializeHeaderAnimation(),initializeModalHandlers(),initializeHeroAnimation();}),'loading'===document.readyState?document.addEventListener('DOMContentLoaded',initializeObservers):setTimeout(initializeObservers,100),window.location.search.includes('v=')&&(cleanUrl=window.location.origin+window.location.pathname,window.history.replaceState({},document.title,cleanUrl));